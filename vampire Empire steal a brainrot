local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AdvancedProtectionGUI"
ScreenGui.Parent = game.CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 220, 0, 260)
Frame.Position = UDim2.new(0.1, 0, 0.1, 0)
Frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui
Frame.Active = true
Frame.Draggable = true

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = Frame
UIListLayout.Padding = UDim.new(0,8)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Helper to create buttons
local function createToggleButton(text)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 40)
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 18
    btn.Text = text .. " [OFF]"
    btn.BorderSizePixel = 0
    btn.Parent = Frame
    return btn
end

local antiDieEnabled = false
local speedEnabled = false
local infiniteJumpEnabled = false

local normalSpeed = 16
local speedValue = 50

-- Anti-Die Implementation
local function setupAntiDie()
    local player = LocalPlayer
    local function getHumanoid()
        local char = player.Character or player.CharacterAdded:Wait()
        return char:WaitForChild("Humanoid")
    end

    spawn(function()
        while antiDieEnabled do
            local hum = getHumanoid()
            if hum.Health < hum.MaxHealth then
                hum.Health = hum.MaxHealth
            end
            hum.BreakJointsOnDeath = false
            task.wait(0.1)
        end
    end)

    -- Reset engelleme
    spawn(function()
        while antiDieEnabled do
            local hum = getHumanoid()
            if hum:GetState() == Enum.HumanoidStateType.Dead then
                hum.Health = hum.MaxHealth
                hum:ChangeState(Enum.HumanoidStateType.Running)
            end
            task.wait(0.1)
        end
    end)
end

-- Speed button
local speedBtn = createToggleButton("Speed")
speedBtn.MouseButton1Click:Connect(function()
    speedEnabled = not speedEnabled
    speedBtn.Text = "Speed [" .. (speedEnabled and "ON" or "OFF") .. "]"
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        char.Humanoid.WalkSpeed = speedEnabled and speedValue or normalSpeed
    end
end)

-- Infinite Jump button
local infJumpBtn = createToggleButton("Infinite Jump")
infJumpBtn.MouseButton1Click:Connect(function()
    infiniteJumpEnabled = not infiniteJumpEnabled
    infJumpBtn.Text = "Infinite Jump [" .. (infiniteJumpEnabled and "ON" or "OFF") .. "]"
end)

-- Anti-Die button
local antiDieBtn = createToggleButton("Anti-Die")
antiDieBtn.MouseButton1Click:Connect(function()
    antiDieEnabled = not antiDieEnabled
    antiDieBtn.Text = "Anti-Die [" .. (antiDieEnabled and "ON" or "OFF") .. "]"
    if antiDieEnabled then
        setupAntiDie()
    end
end)

-- Infinite jump input handler
UserInputService.JumpRequest:Connect(function()
    if infiniteJumpEnabled then
        local char = LocalPlayer.Character
        if char and char:FindFirstChildOfClass("Humanoid") then
            char.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

-- Speed slider GUI
local speedLabel = Instance.new("TextLabel", Frame)
speedLabel.Size = UDim2.new(1, -20, 0, 20)
speedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "Speed: " .. speedValue
speedLabel.Font = Enum.Font.SourceSans
speedLabel.TextSize = 14
speedLabel.TextXAlignment = Enum.TextXAlignment.Left

local speedBox = Instance.new("TextBox", Frame)
speedBox.Size = UDim2.new(1, -20, 0, 30)
speedBox.ClearTextOnFocus = false
speedBox.Text = tostring(speedValue)
speedBox.TextColor3 = Color3.fromRGB(255, 255, 255)
speedBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
speedBox.Font = Enum.Font.SourceSans
speedBox.TextSize = 18
speedBox.BorderSizePixel = 0

speedBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local val = tonumber(speedBox.Text)
        if val and val > 0 and val <= 500 then
            speedValue = val
            speedLabel.Text = "Speed: " .. speedValue
            if speedEnabled then
                local char = LocalPlayer.Character
                if char and char:FindFirstChild("Humanoid") then
                    char.Humanoid.WalkSpeed = speedValue
                end
            end
        else
            speedBox.Text = tostring(speedValue)
        end
    end
end)

-- Karakter değiştiğinde speed değerini ayarla
LocalPlayer.CharacterAdded:Connect(function(char)
    char:WaitForChild("Humanoid")
    if speedEnabled then
        char.Humanoid.WalkSpeed = speedValue
    end
    if antiDieEnabled then
        setupAntiDie()
    end
end)
